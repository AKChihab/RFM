# RFM Customer Segmentation

A reproducible, end-to-end RFM (Recency, Frequency, Monetary) analysis pipeline  
for an international retail company, with synthetic data generation.

📊 RFM Methodology

Recency (R): Days since a customer’s last purchase.
Frequency (F): Count of orders per customer.
Monetary (M): Total spend per customer.
Each dimension is scored 1–5 using pandas’ qcut (quintiles):

R: lower recency_days ⇒ higher R score.
F, M: higher frequency/spend ⇒ higher scores.
We then concatenate R F M into a 3-digit segment (e.g. 555 = best customers) and sum the scores into an overall rfm_score.

## Project Structure

    .
    ├── .gitignore
    ├── pyproject.toml
    ├── README.md
    ├── .venv/ # Virtual environment (gitignored)
    ├── data/
    │ ├── raw/
    │ │ ├── customers.csv # Synthetic customer profiles
    │ │ ├── orders.csv # Synthetic orders
    │ │ └── joined_orders.csv # SQL join output
    │ ├── processed/
    │ │ └── rfm_scores.csv # Final RFM results
    │ └── rfm.db # SQLite database with customers & orders tables
    ├── sql/
    │ ├── create_tables.sql # DDL: schema for customers & orders
    │ └── queries/
    │ └── extract_orders.sql -- SELECT joining orders↔customers
    ├── src/
    │ ├── init.py
    │ ├── synthetic_data.py # Generates data, applies DDL, writes to SQLite & CSV
    │ ├── data_engineering.py # Loads joined data & saves RFM CSV
    │ ├── rfm.py # Pure RFM scoring logic
    │ ├── utils.py # Directory, SQL, date helpers
    │ └── run_pipeline.py # Orchestrator: load → parse → compute → save
    ├── notebooks/
    │ └── 01_EDA.ipynb # Exploratory Data Analysis & visualizations
    └── tests/
    └── test_rfm.py # Unit tests for the RFM logic

## ⚙️ Dependencies

- **Python ≥ 3.10**  
- **pandas**, **numpy**  
- **SQLAlchemy** + **SQLite** (via `sqlite://` connection)  
- **Faker** (for synthetic data)  
- **pytest** (for unit tests)  
- **matplotlib** (for EDA)  

## Getting Started
### . Clone & Initialize
```bash
git clone https://github.com/your-org/RFM.git
cd RFM
git init
```

### Install dependecies all at once:
### From project root, with .venv activated
```bash
pip install -e .
```
### 🔄 Pipeline Overview

| Stage | Command | What Happens |
|-------|---------|--------------|
| **Generate & load synthetic data** | `python -m src.synthetic_data` | • Executes **`sql/create_tables.sql`**<br>• Generates **customers** & **orders** via Faker<br>• Writes raw CSVs to `data/raw/` **and** loads both tables into **`data/rfm.db`**<br>• Runs **`sql/queries/extract_orders.sql`** → `data/raw/joined_orders.csv` |
| **Compute & save RFM scores** | `python -m src.run_pipeline` | • Loads joined data with `data_engineering.load_joined_data()`<br>• Parses date columns via `utils.parse_date_column()`<br>• Calls `rfm.compute_rfm()` for scoring & segmentation<br>• Saves results to `data/processed/rfm_scores.csv` |
| **Exploratory Data Analysis** | *(Jupyter)* | • Open **`notebooks/01_EDA.ipynb`**<br>• Visualize distributions, time-lags, R × F heatmaps, segment comparisons |
| **Testing** | `pytest -v` | • Executes unit tests in **`tests/test_rfm.py`** to validate RFM logic |

### 💾 SQL Files & Database

| File / Object | Purpose |
|---------------|---------|
| **`sql/create_tables.sql`** | DDL for `customers` and `orders` tables (includes foreign-key constraint) |
| **`sql/queries/extract_orders.sql`** | Joins **orders ↔ customers** and selects all key fields |
| **`data/rfm.db`** | SQLite database generated by `src/synthetic_data.py`, containing:<br>• `customers(customer_id, signup_date)`<br>• `orders(order_id, customer_id, order_date, order_amount)` |

Inspect the database with SQLite CLI:

```bash
sqlite3 data/rfm.db
.tables
.schema customers
.schema orders
.exit
```
### ▶️ How to Run

| Step | Command / Action | Notes |
|------|------------------|-------|
| **Activate virtual-env** | `source .venv/bin/activate` <br>*(Windows PowerShell)* `.\.venv\Scripts\Activate.ps1` | Ensures you’re using the project’s isolated Python environment |
| **Install dependencies** | `pip install -e .` | Editable install picks up all requirements from **`pyproject.toml`** |
| **Generate & load data** | `python -m src.synthetic_data` | Creates schema, generates synthetic customers & orders, populates **`data/rfm.db`**, exports raw CSVs |
| **Compute & save RFM** | `python -m src.run_pipeline` | Loads joined data, scores customers, writes **`data/processed/rfm_scores.csv`** |
| **Explore in Jupyter** | Launch notebook → `notebooks/01_EDA.ipynb` | Run all cells to view EDA plots and tables |
| **Run tests** | `pytest -v` | Executes unit tests in **`tests/test_rfm.py`** |