# RFM Customer Segmentation

A reproducible, end-to-end RFM (Recency, Frequency, Monetary) analysis pipeline  
for an international retail company, with synthetic data generation.

ğŸ“Š RFM Methodology

Recency (R): Days since a customerâ€™s last purchase.
Frequency (F): Count of orders per customer.
Monetary (M): Total spend per customer.
Each dimension is scored 1â€“5 using pandasâ€™ qcut (quintiles):

R: lower recency_days â‡’ higher R score.
F, M: higher frequency/spend â‡’ higher scores.
We then concatenate Râ€†Fâ€†M into a 3-digit segment (e.g. 555 = best customers) and sum the scores into an overall rfm_score.

## Project Structure

    .
    â”œâ”€â”€ .gitignore
    â”œâ”€â”€ pyproject.toml
    â”œâ”€â”€ README.md
    â”œâ”€â”€ .venv/ # Virtual environment (gitignored)
    â”œâ”€â”€ data/
    â”‚ â”œâ”€â”€ raw/
    â”‚ â”‚ â”œâ”€â”€ customers.csv # Synthetic customer profiles
    â”‚ â”‚ â”œâ”€â”€ orders.csv # Synthetic orders
    â”‚ â”‚ â””â”€â”€ joined_orders.csv # SQL join output
    â”‚ â”œâ”€â”€ processed/
    â”‚ â”‚ â””â”€â”€ rfm_scores.csv # Final RFM results
    â”‚ â””â”€â”€ rfm.db # SQLite database with customers & orders tables
    â”œâ”€â”€ sql/
    â”‚ â”œâ”€â”€ create_tables.sql # DDL: schema for customers & orders
    â”‚ â””â”€â”€ queries/
    â”‚ â””â”€â”€ extract_orders.sql -- SELECT joining ordersâ†”customers
    â”œâ”€â”€ src/
    â”‚ â”œâ”€â”€ init.py
    â”‚ â”œâ”€â”€ synthetic_data.py # Generates data, applies DDL, writes to SQLite & CSV
    â”‚ â”œâ”€â”€ data_engineering.py # Loads joined data & saves RFM CSV
    â”‚ â”œâ”€â”€ rfm.py # Pure RFM scoring logic
    â”‚ â”œâ”€â”€ utils.py # Directory, SQL, date helpers
    â”‚ â””â”€â”€ run_pipeline.py # Orchestrator: load â†’ parse â†’ compute â†’ save
    â”œâ”€â”€ notebooks/
    â”‚ â””â”€â”€ 01_EDA.ipynb # Exploratory Data Analysis & visualizations
    â””â”€â”€ tests/
    â””â”€â”€ test_rfm.py # Unit tests for the RFM logic

## âš™ï¸ Dependencies

- **Python â‰¥ 3.10**  
- **pandas**, **numpy**  
- **SQLAlchemy** + **SQLite** (via `sqlite://` connection)  
- **Faker** (for synthetic data)  
- **pytest** (for unit tests)  
- **matplotlib** (for EDA)  

## Getting Started
### . Clone & Initialize
```bash
git clone https://github.com/your-org/RFM.git
cd RFM
git init
```

### Install dependecies all at once:
### From project root, with .venv activated
```bash
pip install -e .
```
### ğŸ”„ Pipeline Overview

| Stage | Command | What Happens |
|-------|---------|--------------|
| **Generate & load synthetic data** | `python -m src.synthetic_data` | â€¢ Executes **`sql/create_tables.sql`**<br>â€¢ Generates **customers** & **orders** via Faker<br>â€¢ Writes raw CSVs to `data/raw/` **and** loads both tables into **`data/rfm.db`**<br>â€¢ Runs **`sql/queries/extract_orders.sql`** â†’ `data/raw/joined_orders.csv` |
| **Compute & save RFM scores** | `python -m src.run_pipeline` | â€¢ Loads joined data with `data_engineering.load_joined_data()`<br>â€¢ Parses date columns via `utils.parse_date_column()`<br>â€¢ Calls `rfm.compute_rfm()` for scoring & segmentation<br>â€¢ Saves results to `data/processed/rfm_scores.csv` |
| **Exploratory Data Analysis** | *(Jupyter)* | â€¢ Open **`notebooks/01_EDA.ipynb`**<br>â€¢ Visualize distributions, time-lags, R Ã— F heatmaps, segment comparisons |
| **Testing** | `pytest -v` | â€¢ Executes unit tests in **`tests/test_rfm.py`** to validate RFM logic |

### ğŸ’¾ SQL Files & Database

| File / Object | Purpose |
|---------------|---------|
| **`sql/create_tables.sql`** | DDL for `customers` and `orders` tables (includes foreign-key constraint) |
| **`sql/queries/extract_orders.sql`** | Joins **orders â†” customers** and selects all key fields |
| **`data/rfm.db`** | SQLite database generated by `src/synthetic_data.py`, containing:<br>â€¢ `customers(customer_id, signup_date)`<br>â€¢ `orders(order_id, customer_id, order_date, order_amount)` |

Inspect the database with SQLite CLI:

```bash
sqlite3 data/rfm.db
.tables
.schema customers
.schema orders
.exit
```
### â–¶ï¸ How to Run

| Step | Command / Action | Notes |
|------|------------------|-------|
| **Activate virtual-env** | `source .venv/bin/activate` <br>*(Windows PowerShell)* `.\.venv\Scripts\Activate.ps1` | Ensures youâ€™re using the projectâ€™s isolated Python environment |
| **Install dependencies** | `pip install -e .` | Editable install picks up all requirements from **`pyproject.toml`** |
| **Generate & load data** | `python -m src.synthetic_data` | Creates schema, generates synthetic customers & orders, populates **`data/rfm.db`**, exports raw CSVs |
| **Compute & save RFM** | `python -m src.run_pipeline` | Loads joined data, scores customers, writes **`data/processed/rfm_scores.csv`** |
| **Explore in Jupyter** | Launch notebook â†’ `notebooks/01_EDA.ipynb` | Run all cells to view EDA plots and tables |
| **Run tests** | `pytest -v` | Executes unit tests in **`tests/test_rfm.py`** |